# PureLogic compiler

## –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

* üü¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DDL –∏–∑ —Ñ–∞–π–ª–æ–≤ —Å—Ö–µ–º—ã
* üü¢ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ö–µ–º—ã –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
* ‚ö´ –û–±–∑–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Å—Ö–µ–º—ã
* ‚ö´ –ü–æ–∏—Å–∫ –æ—Ç–ª–∏—á–∏–π –º–µ–∂–¥—É –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π –∏ —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
* ‚ö´ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
* ‚ö´ –ê–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

–î–ª—è –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –∫–æ–Ω—Å–æ–ª—å:

`python .\main.py compile <input>`

–î–ª—è –≤—ã–≤–æ–¥–∞ –≤ —Ñ–∞–π–ª:

`python .\main.py compile <input> --output <output>`

`python .\main.py compile <input> -o <output>`

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏:
* `--silent` –∏–ª–∏ `-s` - –Ω–µ –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –ï—Å–ª–∏ –≤—ã–≤–æ–¥ —Å—Ö–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ 
    –∫–æ–Ω—Å–æ–ª—å - –≤—ã–≤–µ–¥–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ö–µ–º—É, –±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
* `--non-recursive` - –æ—Ç–∫–ª—é—á–∞–µ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ –ø–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Å—Ö–µ–º—ã
* `--encoding` - –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ DDL —Ñ–∞–π–ª–∞

## –°–∏–Ω—Ç–∞–∫—Å–∏—Å PureLogic

### –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

–¢–∞–±–ª–∏—Ü—ã –º–æ–∂–Ω–æ –æ–±—ä—è–≤–ª—è—Ç—å –∫–∞–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ö–µ–º—ã, —Ç–∞–∫ –∏ –±–µ–∑.
–ï—Å–ª–∏ —Å—Ö–µ–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è public.

```yaml
my_table1:
  id: serial

public.my_table2:
  id: serial

my_schema.my_table3:
  id: serial
```

### –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π

```yaml
table:
  # –û–±—ã—á–Ω–æ–µ –ø–æ–ª–µ. –ö–ª—é—á–æ–º —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–º—è –ø–æ–ª—è, –∑–Ω–∞—á–µ–Ω–∏–µ–º - –µ–≥–æ —Ç–∏–ø.
  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–∂–Ω–æ –ª—é–±–æ–π PostgreSQL —Ç–∏–ø, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞
  # (–≤—Å–µ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –≤ PostgreSQL –∏–º–µ—é—Ç –æ–¥–Ω–æ—Å–ª–æ–≤–Ω—ã–π —Å–∏–Ω–æ–Ω–∏–º)
  basic_field: int

  # –ü–æ-—É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ –ø–æ–ª—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ NOT NULL, —Ç.–µ. –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ,
  # –Ω–æ –∏—Ö –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏, –¥–æ–±–∞–≤–∏–≤ –∫ —Ç–∏–ø—É '?'
  optional_field: int?

  # –ö–ª—é—á–µ–≤—ã–µ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
  unique_field: uq int
  strict_unique_field: uq! int  # PG 15+ –†–∞–∑—Ä–µ—à–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º 1 NULL
  primary_key_field: pk int

  # –û–¥–Ω–æ –ø–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏.

  # DEFAULT. –ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–∞–≤–∞—Ç—å –ø–æ–ª—è–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é.
  # –í—Å—ë –ø–æ—Å–ª–µ –∑–Ω–∞–∫–∞ '=' –¥–æ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏ (–∏–ª–∏ –¥–æ '--', –µ—Å–ª–∏ –µ—Å—Ç—å) 
  # –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π SQL
  default_field: int = 5

  # GENERATED. –ò–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π.
  # –í—Å—ë –ø–æ—Å–ª–µ –∑–Ω–∞–∫–∞ ':=' –¥–æ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏ (–∏–ª–∏ –¥–æ '--', –µ—Å–ª–∏ –µ—Å—Ç—å) 
  # –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π SQL
  generated_field: int := default_field + basic_field

  # –ü–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∫–∞–∫ DEFAULT –∏ –∫–∞–∫ GENERATED.

  # –ü–æ–ª—è–º –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –±–∞–∑—É.
  # –í—Å—ë –ø–æ—Å–ª–µ '--' –¥–æ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏ —Å—Ç–∞–Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º. –ü—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ
  # –∏ –≤ –∫–æ–Ω—Ü–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —É–¥–∞–ª—è—é—Ç—Å—è.
  commented_field: int  -- Hello world!
```

### –û–ø–∏—Å–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π

```yaml
table:
  # –ü–æ–ª–µ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–∞–∫ —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á, –µ—Å–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å 'fk'.
  # Fk-–ø–æ–ª—è –∏–º–µ—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π:
  # - –≤–º–µ—Å—Ç–æ —Ç–∏–ø–∞ –≤ –Ω–∏—Ö —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —Å—Å—ã–ª–∞–µ—Ç—Å—è –ø–æ–ª–µ
  # - fk-–ø–æ–ª—è –Ω–µ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –∏–ª–∏ –±—ã—Ç—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–º–∏
  fk_field: fk another_table

  # –¢–∞–±–ª–∏—Ü—ã –≤ fk-–ø–æ–ª—è—Ö —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –∏–ª–∏ –Ω–µ –∏–º–µ—Ç—å —è–≤–Ω–æ –∑–∞–¥–∞–Ω–Ω—É—é —Å—Ö–µ–º—É
  # –ü–æ-—É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ö–µ–º–∞ 'public'
  fk_field_2: fk my_schema.third_table

  # –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å fk-–ø–æ–ª—è –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–∫ –∂–µ –∫–∞–∫ –∏ –¥–ª—è –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—è.
  # –¢–∏–ø —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—Ç–æ—è—Ç—å –ø–µ—Ä–µ–¥ 'fk'.
  pk_fk_field: pk fk another_table

  # –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–Ω–∞–∫–æ–º '?' —Å—Ç–æ—è—â–∏–º –ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã
  optional_fk_field: fk another_table?

  # –ï—Å–ª–∏ fk-–ø–æ–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–æ –∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, —Ç–æ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é
  # –∏–¥—ë—Ç —Å—Å—ã–ª–∫–∞ - –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. ON DELETE NO ACTION
  no_action_fk: fk some_table

  # fk-–ø–æ–ª—è –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ –∫–∞–∫ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –≤ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
  # NULL. ON DELETE SET NULL
  set_null_fk: fk some_table?

  # –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å—å —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª—è–ª–∞—Å—å –≤–º–µ—Å—Ç–µ —Å –∑–∞–ø–∏—Å—å—é –≤
  # —Ç–∞–±–ª–∏—Ü–µ –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –∏–¥—ë—Ç —Å—Å—ã–ª–∫–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–º–≤–æ–ª '!'. ON DELETE CASCADE
  cascade_fk: fk some_table!
  # –ö–∞—Å–∫–∞–¥–Ω—ã–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç–æ–º
```

### –û–ø–∏—Å–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π. CONSTRAINT

```yaml
table:
  # –ï—Å–ª–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ –ø–æ–ª–µ, –µ—ë –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä—è–º–æ —Ç–∞–º,
  # –Ω–æ –µ—Å–ª–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ, —Ç–æ –∑–¥–µ—Å—å –≤—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–º–æ–∂–µ—Ç —Ç–∞–∫–∞—è –∑–∞–ø–∏—Å—å:
  $pk: [field1, field2, ...]
  $uq: [field1, field2, ...]
  $uq!: [field1, field2, ...]

  # –¢–∞–∫–∂–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CHECK, —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
  $check: field1 != field2
  # –í –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∏—à–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤ —Ç–∞–∫–æ–º –∂–µ –≤–∏–¥–µ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–æ
  # –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –≤ SQL

  # –ï—Å–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ, –∏–º –º–æ–∂–Ω–æ –¥–∞—Ç—å –∏–º–µ–Ω–∞.
  # –ò–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω—ã —Å —Ç–∏–ø–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–º '_'
  $check_another: true
  $pk_2: [field1]
```

## –ü—Ä–∏–º–µ—Ä—ã

```yaml
public.library:
  id: pk uuid = gen_random_uuid()  -- id –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
  # –ü–æ–ª–µ 'id', —Ç–∏–ø–∞ 'uuid', —è–≤–ª—è—é—â–µ–µ—Å—è –∫–ª—é—á–µ–≤—ã–º
  # –∏ –∏–º–µ—é—â–µ–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é
  # gen_random_uuid()

  name: text  -- –ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

public.book:
  id: pk uuid = gen_random_uuid()
  library_id: fk public.library?
```

–ü–æ—Å–ª–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:

```sql
DROP SCHEMA IF EXISTS public CASCADE;

CREATE SCHEMA public;

CREATE TABLE public.library (
    id uuid NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name text NOT NULL
);

COMMENT ON COLUMN public.library.id IS 'id –±–∏–±–ª–∏–æ—Ç–µ–∫–∏';
COMMENT ON COLUMN public.library.name IS '–ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏';

CREATE TABLE public.book (
    id uuid NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    library_id uuid
);

ALTER TABLE public.book ADD CONSTRAINT fk_public_book_library_id FOREIGN KEY (library_id) REFERENCES public.library (id) ON DELETE SET NULL;
```
